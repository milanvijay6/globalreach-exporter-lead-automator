## 2025-05-24 - Unprotected Parse Queries with Master Key
**Vulnerability:** Critical authorization bypass in `server/routes/messages.js`. The route handlers used `useMasterKey: true` to bypass Parse ACLs/CLPs but lacked any Express-level authentication middleware (`authenticateUser` or `requireAuth`). This allowed unauthenticated attackers to read and write messages with full administrative privileges.
**Learning:** The codebase mixes Express routes with Parse Server logic. While Parse Server handles auth internally for its routes, custom Express routes wrapping Parse logic (using the JS SDK) must manually enforce authentication. The presence of `authenticateUser` in other files gave a false sense of security, but it was not applied globally or consistently.
**Prevention:** Ensure all Express routes that access sensitive data or use `useMasterKey: true` are protected by `authenticateUser` AND `requireAuth` middleware. Prefer applying these middlewares at the router level (`router.use`) to prevent accidental omission in individual handlers.
